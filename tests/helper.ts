import {
  type Account,
  Aptos,
  type UserTransactionResponse,
  type TypeTag,
  type EntryFunctionArgumentTypes,
  type HexInput,
  type InputGenerateTransactionData,
  type SimpleEntryFunctionArgumentTypes,
  AccountAddress,
  isUserTransactionResponse,
  type AnyRawTransaction,
  NetworkToNetworkName,
  AptosConfig,
  Network,
} from "@aptos-labs/ts-sdk";
import { type ObjectAddressStruct } from "src/boilerplate/types";
import publishJson from "./move/arguments/publish.json";

export async function publishPackage(
  aptos: Aptos,
  senderAccount: Account,
  metadataBytes: HexInput,
  codeBytes: Array<HexInput>,
) {
  const rawTransaction = await aptos.publishPackageTransaction({
    account: senderAccount.accountAddress.toString(),
    metadataBytes,
    moduleBytecode: codeBytes,
  });
  const txn = await aptos.signAndSubmitTransaction({
    signer: senderAccount,
    transaction: rawTransaction,
  });
  return (await aptos.waitForTransaction({
    transactionHash: txn.hash,
  })) as UserTransactionResponse;
}

// Transaction builder helpers
// single signer
export async function rawTransactionHelper(
  aptos: Aptos,
  senderAccount: Account,
  functionName: string,
  typeArgs: TypeTag[],
  args: Array<EntryFunctionArgumentTypes | SimpleEntryFunctionArgumentTypes>,
): Promise<UserTransactionResponse> {
  const rawTransaction = await aptos.transaction.build.simple({
    sender: senderAccount.accountAddress.toString(),
    data: {
      function: `${senderAccount.accountAddress.toString()}::tx_args_module::${functionName}`,
      typeArguments: typeArgs,
      functionArguments: args,
    },
  });
  const senderAuthenticator = await aptos.transaction.sign({
    signer: senderAccount,
    transaction: rawTransaction,
  });
  const transactionResponse = await aptos.transaction.submit.simple({
    transaction: rawTransaction,
    senderAuthenticator,
  });
  const response = await aptos.waitForTransaction({
    transactionHash: transactionResponse.hash,
  });
  return response as UserTransactionResponse;
}

// multi agent/fee payer
export const rawTransactionMultiAgentHelper = async (
  aptos: Aptos,
  senderAccount: Account,
  functionName: string,
  typeArgs: Array<TypeTag>,
  args: Array<EntryFunctionArgumentTypes | SimpleEntryFunctionArgumentTypes>,
  secondarySignerAccounts: Array<Account>,
  feePayerAccount?: Account,
): Promise<UserTransactionResponse> => {
  let transactionData: InputGenerateTransactionData;
  let generatedTransaction: AnyRawTransaction;
  // Fee payer
  if (feePayerAccount) {
    transactionData = {
      sender: senderAccount.accountAddress,
      data: {
        function: `${senderAccount.accountAddress}::tx_args_module::${functionName}`,
        typeArguments: typeArgs,
        functionArguments: args,
      },
      secondarySignerAddresses: secondarySignerAccounts?.map(
        (account) => account.accountAddress.data,
      ),
      withFeePayer: true,
    };
    generatedTransaction = await aptos.transaction.build.multiAgent(transactionData);
  } else if (secondarySignerAccounts) {
    transactionData = {
      sender: senderAccount.accountAddress,
      data: {
        function: `${senderAccount.accountAddress}::tx_args_module::${functionName}`,
        typeArguments: typeArgs,
        functionArguments: args,
      },
      secondarySignerAddresses: secondarySignerAccounts?.map(
        (account) => account.accountAddress.data,
      ),
    };
    generatedTransaction = await aptos.transaction.build.multiAgent(transactionData);
  } else {
    transactionData = {
      sender: senderAccount.accountAddress,
      data: {
        function: `${senderAccount.accountAddress}::tx_args_module::${functionName}`,
        typeArguments: typeArgs,
        functionArguments: args,
      },
    };
    generatedTransaction = await aptos.transaction.build.simple(transactionData);
  }

  const senderAuthenticator = aptos.transaction.sign({
    signer: senderAccount,
    transaction: generatedTransaction,
  });

  const secondaryAuthenticators = secondarySignerAccounts.map((account) =>
    aptos.transaction.sign({
      signer: account,
      transaction: generatedTransaction,
    }),
  );

  let feePayerAuthenticator;
  let transactionResponse;
  if (feePayerAccount !== undefined) {
    feePayerAuthenticator = aptos.transaction.signAsFeePayer({
      signer: feePayerAccount,
      transaction: generatedTransaction,
    });
    transactionResponse = await aptos.transaction.submit.multiAgent({
      transaction: generatedTransaction,
      senderAuthenticator,
      additionalSignersAuthenticators: secondaryAuthenticators,
      feePayerAuthenticator,
    });
  } else {
    transactionResponse = await aptos.transaction.submit.multiAgent({
      transaction: generatedTransaction,
      senderAuthenticator,
      additionalSignersAuthenticators: secondaryAuthenticators,
    });
  }

  const response = await aptos.waitForTransaction({
    transactionHash: transactionResponse.hash,
  });
  if (!isUserTransactionResponse(response)) {
    throw new Error("Expected user transaction response");
  }
  return response;
};

export const PUBLISHER_ACCOUNT_PK =
  "0xc694948143dea59c195a4918d7fe06c2329624318a073b95f6078ce54940dae9";
export const PUBLISHER_ACCOUNT_ADDRESS =
  "4cba8c2b7f78052a6d5d67999620fecc77ea3d691d07f2c787151f9864b0b6a8";

// hard-coded bytecode for the contract, so we don't have to recompile it every time in ci
export const ARGUMENT_TESTS_CONTRACT_METADATA = publishJson.args[0].value as string;

// interpolate a named address into the contract bytecode
export async function getModuleBytecodeStrings() {
  const modules = Array.isArray(publishJson.args[1].value)
    ? publishJson.args[1].value
    : [publishJson.args[1].value];
  const modulesWithCorrectAddress = modules.map((module) =>
    String(module).replaceAll(
      "0a56e8b03118e51cf88140e5e18d1f764e0a1048c23e7c56bd01bd5b76993451",
      PUBLISHER_ACCOUNT_ADDRESS,
    ),
  );
  return modulesWithCorrectAddress;
}

export async function publishArgumentTestModule(
  aptos: Aptos,
  senderAccount: Account,
): Promise<UserTransactionResponse> {
  const moduleBytecodeStrings = await getModuleBytecodeStrings();
  const response = await publishPackage(
    aptos,
    senderAccount,
    ARGUMENT_TESTS_CONTRACT_METADATA,
    moduleBytecodeStrings,
  );
  return response;
}

export const normalizeObjectAddress = (obj: ObjectAddressStruct) => ({
  inner: AccountAddress.from(obj.inner).toString(),
});

// To normalize the addresses. We do this because the first Object address starts with a 0, the
// JSON response doesn't include it but ours does.
export const normalizeObjectAddresses = (vectorOfObjects: Array<ObjectAddressStruct>) =>
  vectorOfObjects.map((obj: ObjectAddressStruct) => normalizeObjectAddress(obj));

// Script function byte code from `arguments/sources/script.move` for the
// transaction_arguments.test.ts script function tests.
export const MULTI_SIGNER_SCRIPT_ARGUMENT_TEST =
  // eslint-disable-next-line max-len
  `a11ceb0b060000000601000802080e03160a05203907596408bd0140000000010002010302040700000507010001030608000107020300030804010015060c060c060c060c060c050505050501020d0e03040f0508000b010108020a020001060c01050b01020d0e03040f0508000b010108020a02066f626a656374067369676e657206737472696e670e74785f617267735f6d6f64756c6506537472696e67064f626a6563740d456d7074795265736f757263650a616464726573735f6f66186173736572745f76616c7565735f666f725f7363726970740000000000000000000000000000000000000000000000000000000000000001${PUBLISHER_ACCOUNT_ADDRESS}000001490b0011000b0521040605100b04010b03010b02010b0101066400000000000000270b0111000b06210416051e0b04010b03010b0201066500000000000000270b0211000b07210424052a0b04010b0301066600000000000000270b0311000b0821043005340b0401066700000000000000270b0411000b0921043a053c066800000000000000270b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b14110102${PUBLISHER_ACCOUNT_ADDRESS}000001490b0011000b0521040605100b04010b03010b02010b0101066400000000000000270b0111000b06210416051e0b04010b03010b0201066500000000000000270b0211000b07210424052a0b04010b0301066600000000000000270b0311000b0821043005340b0401066700000000000000270b0411000b0921043a053c066800000000000000270b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b14110102${PUBLISHER_ACCOUNT_ADDRESS}000001150b0011000b012104060508066400000000000000270b020b030b040b050b060b070b080b090b0a0b0b0b0c110102`;

// Interpolate a named address into the contract bytecode.
export async function getContractBytecode() {
  // eslint-disable-next-line max-len
  return `0xa11ceb0b060000000c01001002101c032cc00104ec018e0205fa03990b07930ff704088a144006ca14aa0710f41b82020af61d1a0c901efb340d8b5306000001010102010301040105010601070008080000090800050a0700020b07010001030d0701000002280200000c000100000e020100000f0103000010010400001101050000120601000013070100001408010000150701000016080100001701011f000000000000000000000000000000000000000000000000000000000000000018090105020202020800190a0a00051e0c0d00011f0f0f0007201001010003211213010003221617010003231617010003241618010003251917010003261a12010002271d1e01080429061e00022a1e2200022b232400022c23250108032d01130100062e010d01000f0e10030f0c0f030f0d0f14110312031303140315030f15161c1a1c0f210f170f270f280f0f0f290f2a0f1e1b0e110e120e130e140e10171117121713171417100e1027112712271327142710281128122813281428100f110f120f130f140f10291129122913291429102a112a122a132a142a101e111e121e131e141e100d110d120d130d140d102111211221132114211c121c171c2d1c0e1c2e1c271c2f1c281c301c0f1c311c291c321c2a1c331c1e1c341c0d1c351c211c361c371c381c0c1c391c3a1c3b1c3c1c3d1c3e1c3f1c401c411c421c431c441c451c031c461c471c481c491c4a1c4b1c4c1c4d1c4e1c4f1c501c511c521c531c541c551c561c571c581c591c5a1c5b1c5c1c5d0b01020d0e03040f0508020b030108000a0200040a0a020a0a08020a0b04010a08020a0a0b04010a0802010a080203050505030b030108000b030108000b0301080001060c21060c01020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b0301080026060c0c060c0c060c0a0501020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000509000901090209030b030109042001020d0e03040f0508020b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b0301080009030b03010800030a020a020a020a020a020a02010a020108020102010301070a0900530b04010a08020b04010a080203030303030303030b04010a08020b04010a08020a0a08020a0b04010a08020a0a0b04010a0802060a0802060a08020303030303030303030b04010a08020b04010a08020b04010a08020b04010a08020a08020a08020a08020a08020b04010a08020a0a0b04010a08020a0a020a020a020a0a020a0a08020a08020a08020a0a08020a0b04010a08020a08020a08020a0b04010a08020a0a0b04010a08020a0b04010a08020a08020a08020a0b04010a08020a0a0b04010a08020a0a020a020a020a0a020a0a08020a08020a08020a0a08020a0b04010a08020a08020a08020a0b04010a08020a0a0b04010a08020a0b04010a08020a08020a08020a0b04010a08020a0a020a020a0a08020a08020a08020a08020a0a020a020a0a08020a08020a08020a0802010900010b04010900010b04010a0802010a0b04010a080201060b0401090001010106090002060b0401090006090001070b0401090007070a08020a02030a08020a020a0a020a0a0201080001060b03010900010501060801060805030b030108000c0a0b030108000801010b0301080001080501060805010c010b0301090089010a0b0301080003030303030303030303030303030303030303030303060206010602060d060e06030604060f0605060802060b030108000b0301080003030303030303030303030b030108000b030108000b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000b0401020b0401010b0401020b04010d0b04010e0b0401030b0401040b04010f0b0401050b040108020b04010b030108000a020a020a010a010a020a020a0d0a0d0a0e0a0e0a030a030a040a040a0f0a0f0a050a050a08020a08020a0b030108000a0b030108000a020a020a010a010a020a020a0d0a0d0a0e0a0e0a030a030a040a040a0f0a0f0a050a050a08020a08020a0b030108000a0b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b030108000a020a010a020a0d0a0e0a030a040a0f0a050a08020a0b03010800010d010e0104010f0903030a050a050a050a050a050a050a051e01010101010101010101010101010101010101010101010101010101010101090101090201090301090401090501090601090701090801090901090a010a0101090b01090c010a0d01090d010a0e01090e010a0301090f010a04010910010a0f010911010a05010912010913010a0b03010800010914010b040101010915010b040102010916010b04010d010917010b04010e010918010b040103010919010b04010401091a010b04010f01091b010b04010501091c010b0401080201091d010b04010b0301080001091e010a0a0b04010a0b04010b030108000e74785f617267735f6d6f64756c65056572726f72066f626a656374066f7074696f6e067369676e657206737472696e6709747970655f696e666f06766563746f720d456d7074795265736f757263650953657475704461746106537472696e67064f626a656374186173736572745f76616c7565735f666f725f736372697074064f7074696f6e11636f6d706c65785f617267756d656e74731a6765745f65787065637465645f766563746f725f737472696e67196765745f746573745f6f626a6563745f616464726573736573106765745f746573745f6f626a656374730b696e69745f6d6f64756c6511707269766174655f617267756d656e747322707269766174655f617267756d656e74735f6d756c7469706c655f7369676e657273107075626c69635f617267756d656e7473217075626c69635f617267756d656e74735f6d756c7469706c655f7369676e65727309747970655f7461677312747970655f746167735f666f725f6172677312766965775f616c6c5f617267756d656e74730b64756d6d795f6669656c640e656d7074795f6f626a6563745f310e656d7074795f6f626a6563745f320e656d7074795f6f626a6563745f3304757466380d696e76616c69645f7374617465077265766572736504736f6d650769735f6e6f6e650769735f736f6d6506626f72726f7708636f6e7461696e7307657874726163740e6f626a6563745f616464726573730e436f6e7374727563746f725265660a616464726573735f6f660d6372656174655f6f626a6563740f67656e65726174655f7369676e65721b6f626a6563745f66726f6d5f636f6e7374727563746f725f726566046e6f6e6509747970655f6e616d65${PUBLISHER_ACCOUNT_ADDRESS}00000000000000000000000000000000000000000000000000000000000000010308d007000000000000030810270000000000000308611e0000000000000520${PUBLISHER_ACCOUNT_ADDRESS}0101010a02100f65787065637465645f737472696e670410050000000000000000000000000000000d0202000f2006000000000000000000000000000000000000000000000000000000000000000e0403000000030804000000000000000201010a05c1010600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abc0000000000000000000000000000000000000000000000000000000000000def0000000000000000000000000000000000000000000000000000000000000123000000000000000000000000000000000000000000000000000000000000045600000000000000000000000000000000000000000000000000000000000007890a0104030100010a0a0225060f65787065637465645f737472696e6703616263036465660331323303343536033738390a046106000000000000000000000000000000000100000000000000000000000000000002000000000000000000000000000000fdfffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0a0d0d06000001000200fdfffeffffff0a0fc10106000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000fdfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0a0e1906000000000100000002000000fdfffffffeffffffffffffff0a033106000000000000000001000000000000000200000000000000fdfffffffffffffffeffffffffffffffffffffffffffffff0a020706000102fdfeff030864000000000000000410ffffffffffffffffffffffffffffffff0d02ffff0f20ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0e04ffffffff0308ffffffffffffffff0201ff03082c01000000000000030890010000000000000308f4010000000000000308c8000000000000000a020100126170746f733a3a6d657461646174615f7631ed010601000000000000000b45585045435445445f55380002000000000000000c45585045435445445f5531360003000000000000000c45585045435445445f5533320004000000000000000c45585045435445445f5536340005000000000000000d45585045435445445f553132380006000000000000000d45585045435445445f55323536000004106765745f746573745f6f626a6563747301010012766965775f616c6c5f617267756d656e7473010100196765745f746573745f6f626a6563745f6164647265737365730101001a6765745f65787065637465645f766563746f725f737472696e670101000002011a010102031b0b030108001c0b030108001d0b0301080000010001010b8e0107032b011000140c0c0b00070421040a050c060000000000000000270b01070b2104110513060100000000000000270b020707210418051a060200000000000000270b03070921041f0521060300000000000000270b04070a2104260528060400000000000000270b05070621042d052f060500000000000000270b0607082104340536060600000000000000270b07070321043b053d060700000000000000270b080705110d2104430545060800000000000000270b090b0c21044a054c060900000000000000270b0a0714060a000000000000000c0b0c130c120e12410e0e13410e210459055e07150b0b16110e270b120b130c100c0e0d0e38000d1038000b0e0b100c110c0f0e0f410e0c0d0a0d0e11410e2104730575060200020000000000270a0d06000000000000000024048901057a0d0f450e0d11450e210481010584010b0b110e270b0d060100000000000000170c0d05750b0f460e00000000000000000b11460e0000000000000000020100040011e704110211021102400303000000000000000c10110238010c260a260a260b26401403000000000000000c110a110a110a11401503000000000000000c120b00071407140714400c03000000000000000600000000000000000c060c510c4b0e4b410c0e51410c210422052707150b0616110e270b4b0b510c3a0c280d2838020d3a38020b280b3a0c3d0c2b0e2b410c0c170a170e3d410c21043c053e060200020000000000270a1706000000000000000024048b0105430d2b450c0d3d450c0a060c070c520c4c0e4c410e0e52410e210452055707150b0716110e270b4c0b520c3b0c290d2938000d3b38000b290b3b0c3c0c2a0e2a410e0c160a160e3c410e21046c056e060200020000000000270a160600000000000000002404820105730d2a450e0d3c450e21047a057d0b07110e270b16060100000000000000170c16056e0b2a460e00000000000000000b3c460e00000000000000000b17060100000000000000170c17053e0b2b460c00000000000000000b3d460c00000000000000000b010b100601000000000000000c080c530c4d0e4d41030e53410321049c0105a10107150b0816110e270b4d0b530c3e0c2c0d2c38030d3e38030b2c0b3e0c410c2f0e2f41030c190a190e4141032104b60105b801060200020000000000270a190600000000000000002404850205bd010d2f45030d4145030a080c090c540c4e0e4e410d0e54410d2104cc0105d10107150b0916110e270b4e0b540c3f0c2d0d2d38040d3f38040b2d0b3f0c400c2e0e2e410d0c180a180e40410d2104e60105e801060200020000000000270a180600000000000000002404fc0105ed010d2e450d0d40450d2104f40105f7010b09110e270b18060100000000000000170c1805e8010b2e460d00000000000000000b40460d00000000000000000b19060100000000000000170c1905b8010b2f460300000000000000000b41460300000000000000000b020b110c420c300d3038050d4238050b300b420c450c330e3341140c1b0a1b0e45411421049e0205a002060200020000000000270a1b0600000000000000002404a00305a5020d3345140d4545140c0e0c040a040a0e0602000000000000000c0a0c200c1e0e1e380604be020e20380604b80205bd02071c0b0a16110e2705d4020e20380704c20205c702071d0b0a16110e270e1e38080c130e200b13380904cf0205d402071e0b0a16110e270d04380a0c220d0e380a0c240b220b240602000000000000000c0b0c550c4f0e4f410d0e55410d2104e70205ec0207150b0b16110e270b4f0b550c430c310d3138040d4338040b310b430c440c320e32410d0c1a0a1a0e44410d21048103058303060200020000000000270a1a060000000000000000240497030588030d32450d0d44450d21048f030592030b0b110e270b1a060100000000000000170c1a0583030b32460d00000000000000000b44460d00000000000000000b1b060100000000000000170c1b05a0020b33461400000000000000000b45461400000000000000000b030b120c460c340d34380b0d46380b0b340b460c390c270e2741150c150a150e3941152104b90305bb03060200020000000000270a150600000000000000002404e20405c0030d2745150d3945150c470c350d3538050d4738050b350b470c4a0c380e3841140c1d0a1d0e4a41142104d70305d903060200020000000000270a1d0600000000000000002404d90405de030d3845140d4a45140c0f0c050a050a0f0603000000000000000c0c0c210c1f0e1f380604f7030e21380604f10305f603071c0b0c16110e27058d040e21380704fb03058004071d0b0c16110e270e1f38080c140e210b143809048804058d04071e0b0c16110e270d05380a0c230d0f380a0c250b230b250603000000000000000c0d0c560c500e50410d0e56410d2104a00405a50407150b0d16110e270b500b560c480c360d3638040d4838040b360b480c490c370e37410d0c1c0a1c0e49410d2104ba0405bc04060200020000000000270a1c0600000000000000002404d00405c1040d37450d0d49450d2104c80405cb040b0d110e270b1c060100000000000000170c1c05bc040b37460d00000000000000000b49460d00000000000000000b1d060100000000000000170c1d05d9030b38461400000000000000000b4a461400000000000000000b15060100000000000000170c1505bb030b27461500000000000000000b394615000000000000000002020100001b24400d00000000000000000c03070e0c050d0538020b050c060e06410c0c020a0206000000000000000024042005100d06450c0c010d030c000b010c040b000b04110d440d0b02060100000000000000170c02050b0b06460c00000000000000000b03020301000101050b11040c020c010c000e00380c0e01380c0e02380c0204010001011f0d07032b010c000a001000140a001001140b00100214020500000020360a0011170703210406050a0b0001070227402100000000000000000c050600000000000000000c020a020603000000000000002304280513070311180c010e0111190c040e040912002d000e01380d0c030d050b0344210b02060100000000000000160c02050e0d05380e0d0545210d0545210d05452112010c060b000b062d0102060004010101230b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b20110802070004010101280b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b200b210b220b230b240b25110902080104010126af0a07032b011000140c430b01070421040a050e070106000000000000000016270b02070b2104130517070106010000000000000016270b03070721041c0520070106020000000000000016270b0407092104250529070106030000000000000016270b05070a21042e0532070106040000000000000016270b060706210437053b070106050000000000000016270b0707082104400544070106060000000000000016270b080703210449054d070106070000000000000016270b090705110d2104530557070106080000000000000016270b0a0a4321045c0560070106090000000000000016270b0b07200701060a00000000000000160c220c9f010c94010e9401410e0e9f01410e21046f057407150b2216110e270b94010b9f010c7e0c680d6838000d7e38000b680b7e0c7f0c690e69410e0c440a440e7f410e21048901058b01060200020000000000270a4406000000000000000024049f010590010d69450e0d7f450e21049701059a010b22110e270b44060100000000000000170c44058b010b69460e00000000000000000b7f460e00000000000000000b0c070d0701060b00000000000000160c230ca0010c95010e950141170ea00141172104b20105b70107150b2316110e270b95010ba0010c80010c6a0d6a380f0d8001380f0b6a0b80010c81010c6b0e6b41170c450a450e810141172104cc0105ce01060200020000000000270a450600000000000000002404e20105d3010d6b45170d810145172104da0105dd010b23110e270b45060100000000000000170c4505ce010b6b461700000000000000000b8101461700000000000000000b0d07140701060c00000000000000160c240ca1010c96010e9601410e0ea101410e2104f50105fa0107150b2416110e270b96010ba1010c82010c6c0d6c38000d820138000b6c0b82010c83010c6d0e6d410e0c460a460e8301410e21048f02059102060200020000000000270a460600000000000000002404a5020596020d6d450e0d8301450e21049d0205a0020b24110e270b46060100000000000000170c460591020b6d460e00000000000000000b8301460e00000000000000000b0e07100701060d00000000000000160c250ca2010c97010e970141270ea20141272104b80205bd0207150b2516110e270b97010ba2010c84010c6e0d6e38100d840138100b6e0b84010c85010c6f0e6f41270c470a470e850141272104d20205d402060200020000000000270a470600000000000000002404e80205d9020d6f45270d850145272104e00205e3020b25110e270b47060100000000000000170c4705d4020b6f462700000000000000000b8501462700000000000000000b0f07120701060e00000000000000160c260ca3010c98010e980141280ea30141282104fb0205800307150b2616110e270b98010ba3010c86010c700d7038110d860138110b700b86010c87010c710e7141280c480a480e8701412821049503059703060200020000000000270a480600000000000000002404ab03059c030d7145280d870145282104a30305a6030b26110e270b48060100000000000000170c480597030b71462800000000000000000b8701462800000000000000000b1007130701060f00000000000000160c270ca4010c99010e9901410f0ea401410f2104be0305c30307150b2716110e270b99010ba4010c88010c720d7238120d880138120b720b88010c89010c730e73410f0c490a490e8901410f2104d80305da03060200020000000000270a490600000000000000002404ee0305df030d73450f0d8901450f2104e60305e9030b27110e270b49060100000000000000170c4905da030b73460f00000000000000000b8901460f00000000000000000b11070f0701061000000000000000160c280ca5010c9a010e9a0141290ea50141292104810405860407150b2816110e270b9a010ba5010c8a010c740d7438130d8a0138130b740b8a010c8b010c750e7541290c4a0a4a0e8b01412921049b04059d04060200020000000000270a4a0600000000000000002404b10405a2040d7545290d8b0145292104a90405ac040b28110e270b4a060100000000000000170c4a059d040b75462900000000000000000b8b01462900000000000000000b1207110701061100000000000000160c290ca6010c9b010e9b01412a0ea601412a2104c40405c90407150b2916110e270b9b010ba6010c8c010c760d7638140d8c0138140b760b8c010c8d010c770e77412a0c4b0a4b0e8d01412a2104de0405e004060200020000000000270a4b0600000000000000002404f40405e5040d77452a0d8d01452a2104ec0405ef040b29110e270b4b060100000000000000170c4b05e0040b77462a00000000000000000b8d01462a00000000000000000b13070c0701061200000000000000160c2a0ca7010c9c010e9c01411e0ea701411e21048705058c0507150b2a16110e270b9c010ba7010c8e010c780d7838150d8e0138150b780b8e010c8f010c790e79411e0c4c0a4c0e8f01411e2104a10505a305060200020000000000270a4c0600000000000000002404b70505a8050d79451e0d8f01451e2104af0505b2050b2a110e270b4c060100000000000000170c4c05a3050b79461e00000000000000000b8f01461e00000000000000000b1411020701061300000000000000160c2b0ca8010c9d010e9d01410d0ea801410d2104ca0505cf0507150b2b16110e270b9d010ba8010c90010c7a0d7a38040d900138040b7a0b90010c91010c7b0e7b410d0c4d0a4d0e9101410d2104e40505e605060200020000000000270a4d0600000000000000002404fa0505eb050d7b450d0d9101450d2104f20505f5050b2b110e270b4d060100000000000000170c4d05e6050b7b460d00000000000000000b9101460d00000000000000000b150c2111040c510c500c4f0b210b4f0b500b51402103000000000000000701061400000000000000160c2c0ca9010c9e010e9e0141210ea901412121049606059b0607150b2c16110e270b9e010ba9010c92010c7c0d7c380e0d9201380e0b7c0b92010c93010c7d0e7d41210c4e0a4e0e930141212104b00605b206060200020000000000270a4e0600000000000000002404c60605b7060d7d45210d930145212104be0605c1060b2c110e270b4e060100000000000000170c4e05b2060b7d462100000000000000000b9301462100000000000000000b1638160701061500000000000000160c2d0c5d0c520e52381704df060e5d381704d90605de06071c0b2d16110e2705f5060e5d381804e30605e806071d0b2d16110e270e5238190c380e5d0b38381a04f00605f506071e0b2d16110e270b170704381b0701061600000000000000160c2e0c5e0c530e53381c048b070e5e381c048507058a07071c0b2e16110e2705a1070e5e381d048f07059407071d0b2e16110e270e53381e0c390e5e0b39381f049c0705a107071e0b2e16110e270b18070b38200701061700000000000000160c2f0c5f0c540e54381704b7070e5f381704b10705b607071c0b2f16110e2705cd070e5f381804bb0705c007071d0b2f16110e270e5438190c3a0e5f0b3a381a04c80705cd07071e0b2f16110e270b19070738210701061800000000000000160c300c600c550e55382204e3070e60382204dd0705e207071c0b3016110e2705f9070e60382304e70705ec07071d0b3016110e270e5538240c3b0e600b3b382504f40705f907071e0b3016110e270b1a070938260701061900000000000000160c310c610c560e563827048f080e613827048908058e08071c0b3116110e2705a5080e613828049308059808071d0b3116110e270e5638290c3c0e610b3c382a04a00805a508071e0b3116110e270b1b070a382b0701061a00000000000000160c320c620c570e57382c04bb080e62382c04b50805ba08071c0b3216110e2705d1080e62382d04bf0805c408071d0b3216110e270e57382e0c3d0e620b3d382f04cc0805d108071e0b3216110e270b1c070638300701061b00000000000000160c330c630c580e58383104e7080e63383104e10805e608071c0b3316110e2705fd080e63383204eb0805f008071d0b3316110e270e5838330c3e0e630b3e383404f80805fd08071e0b3316110e270b1d070838350701061c00000000000000160c340c640c590e5938360493090e643836048d09059209071c0b3416110e2705a9090e643837049709059c09071d0b3416110e270e5938380c3f0e640b3f383904a40905a909071e0b3416110e270b1e0703383a0701061d00000000000000160c350c650c5a0e5a383b04bf090e65383b04b90905be09071c0b3516110e2705d5090e65383c04c30905c809071d0b3516110e270e5a383d0c400e650b40383e04d00905d509071e0b3516110e270b1f0705110d383f0701061e00000000000000160c360c660c5b0e5b384004ec090e66384004e60905eb09071c0b3616110e2705820a0e66384104f00905f509071d0b3616110e270e5b38420c410e660b41384304fd0905820a071e0b3616110e270b200b4338440701061f00000000000000160c370c670c5c0e5c384504980a0e67384504920a05970a071c0b3716110e2705ae0a0e673846049c0a05a10a071d0b3716110e270e5c38470c420e670b42384804a90a05ae0a071e0b3716110e270209010401012b760a0011170e0111170b0211170e0311170b041117401e05000000000000000c280b050b2807000c260c2e0c2d0e2d411e0e2e411e21041905200b000107150b2616110e270b2d0b2e0c2b0c290d2938150d2b38150b290b2b0c2c0c2a0e2a411e0c270a270e2c411e21043505390b0001060200020000000000270a2706000000000000000024044f053e0d2a451e0d2c451e210445054a0b00010b26110e270b27060100000000000000170c2705390b2a461e00000000000000000b2c461e00000000000000000b000b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0b200b210b220b230b240b251108020a0104002c96023849384a210409384b384c210c00050b090c000b000412384d384e210c0b0514090c0b0b0b041b384f3850210c16051d090c160b16042438513852210c180526090c180b18042d38533854210c19052f090c190b19043638553856210c1a0538090c1a0b1a043f38573858210c1b0541090c1b0b1b04483859385a210c1c054a090c1c0b1c0451385b385c210c1d0553090c1d0b1d045a385d385e210c01055c090c010b010463385f3860210c020565090c020b02046c38613862210c03056e090c030b03047538633864210c040577090c040b04047e38653866210c05058001090c050b0504870138673868210c06058901090c060b060490013869386a210c07059201090c070b07049901386b386c210c08059b01090c080b0804a201386d386e210c0905a401090c090b0904ab01386f3870210c0a05ad01090c0a0b0a04b40138713872210c0c05b601090c0c0b0c04bd0138733874210c0d05bf01090c0d0b0d04c60138753876210c0e05c801090c0e0b0e04cf0138773878210c0f05d101090c0f0b0f04d8013879387a210c1005da01090c100b1004e101387b387c210c1105e301090c110b1104ea01387d387e210c1205ec01090c120b1204f301387f388001210c1305f501090c130b1304fc01388101388201210c1405fe01090c140b14048502388301388401210c15058702090c150b15048e02388501388601210c17059002090c170b1704930205950206000000000000000027020b0104000101020c01000001210b000b010b020b030b040b050b060b070b080b090b0a0b0b0b0c0b0d0b0e0b0f0b100b110b120b130b140b150b160b170b180b190b1a0b1b0b1c0b1d0b1e0b1f0201000101010200`;
}

/**
 * Use this function whenever you want an Aptos client.
 *
 * By default it uses Network.LOCAL. You can change this in one of two ways:
 *
 * 1. If you set the APTOS_NETWORK env var, it will use that Network. For example,
 *    export APTOS_NETWORK=devnet.
 * 2. For more control, you can set the APTOS_NODE_API_URL, APTOS_INDEXER_API_URL, and
 *    APTOS_FAUCET_API_URL env vars.
 *
 * The APTOS_NETWORK env var is applied first, followed by the others. So if you set
 * APTOS_NETWORK=devnet and APTOS_NODE_API_URL=http://localhost:8080, it will use the
 * given URL for the node API and the the default URLs for devnet for the other APIs.
 */
export function getAptosClient(additionalConfig?: Partial<AptosConfig>): {
  aptos: Aptos;
  config: AptosConfig;
} {
  const networkRaw = process.env.APTOS_NETWORK;
  const network = networkRaw ? NetworkToNetworkName[networkRaw] : Network.LOCAL;
  if (!network) {
    throw new Error(`Unknown network, confirm APTOS_NETWORK env var is valid: ${networkRaw}`);
  }
  const config = new AptosConfig({
    network,
    fullnode: process.env.APTOS_NODE_API_URL,
    indexer: process.env.APTOS_INDEXER_API_URL,
    faucet: process.env.APTOS_FAUCET_API_URL,
    ...additionalConfig,
  });
  const aptos = new Aptos(config);
  return { aptos, config };
}
